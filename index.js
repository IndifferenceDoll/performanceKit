"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=function(){function a(e){return"function"==typeof e}function i(){try{if(!window)throw new Error("请在浏览器环境下使用");if(!a(window.Promise))throw new Error("不支持Promise");if(!window.performance)throw new Error("不支持performance")}catch(e){console.log(e)}}function ce(e,o){var n=0<arguments.length&&void 0!==e?e:"";return n||0===n?{value:n,info:1<arguments.length&&void 0!==o?o:""}:{}}function s(){var e={};e.nativePerformance=ce(window.performance,"performance的原生对象");var o=window.performance,n=o.timeOrigin,t=void 0===n?0:n,i=o.navigation,r=void 0===i?{}:i;e.monitorStartTimePoint=ce(t,"性能监测开始的时间");var d=r.type,a=void 0===d?"":d,v=r.redirectCount,c=void 0===v?0:v;e.redirectCount=ce(c,"页面被重定向的次数"),e.type=ce(a,me[a]);var m=window.performance.getEntriesByType("navigation")[0],s=m.nextHopProtocol,f=void 0===s?"":s,p=m.name,T=void 0===p?"":p,l=m.redirectStart,w=void 0===l?0:l,u=m.redirectEnd,g=void 0===u?0:u,E=m.domainLookupStart,h=void 0===E?0:E,y=m.domainLookupEnd,S=void 0===y?0:y,P=m.fetchStart,B=void 0===P?0:P,L=m.connectStart,C=void 0===L?0:L,O=m.connectEnd,D=void 0===O?0:O,R=m.secureConnectionStart,k=void 0===R?0:R,_=m.requestStart,z=void 0===_?0:_,A=m.responseStart,F=void 0===A?0:A,H=m.responseEnd,I=void 0===H?0:H,x=m.unloadEventStart,Y=void 0===x?0:x,b=m.unloadEventEnd,j=void 0===b?0:b,M=m.domInteractive,N=void 0===M?0:M,V=m.domComplete,W=void 0===V?0:V,G=m.domContentLoadedEventStart,q=void 0===G?0:G,K=m.domContentLoadedEventEnd,J=void 0===K?0:K,Q=m.serverTiming,U=void 0===Q?[]:Q,X=m.loadEventStart,Z=void 0===X?0:X,$=m.loadEventEnd,ee=void 0===$?0:$,oe=m.workerStart,ne=void 0===oe?0:oe,te=m.transferSize,ie=void 0===te?0:te,re=m.encodedBodySize,de=void 0===re?0:re,ae=m.decodedBodySize,ve=void 0===ae?0:ae;return e.nextHopProtocol=ce(f,"当前请求使用协议"),e.address=ce(T,"当前请求使地址"),e.workerStartTime=ce(ne,"workerServie开始分配工作的时间"),e.transferSize=ce(ie,"表示所取出资源的大小(包含响应头和响应体，若是缓存或跨域，则为0)"),e.encodedBodySize=ce(de,"表示所取出资源编码时的大小(只包含响应体)"),e.decodedBodySize=ce(ve,"表示所取出资源解码后的大小(只包含响应体)"),e.redirectTime=ce(g-w,"重定向花费时间"),e.dnsTime=ce(S-h,"dns解析查询花费时间"),e.TTFBByReal=ce(F-h,"真实的TTFB时间(包含域名解析、tcp链接、请求发起到响应)"),e.TTFBByNetwork=ce(F-z,"network中请求的Wait(TTFB)时间(只包含域请求发起到响应)"),e.appcacheTime=ce(h-B,"应用读取缓存花费时间"),e.unloadTime=ce(j-Y,"当前页面/路由组件卸载花费时间"),e.tcpTime=ce(D-C,"tcp链接花费时间"),e.secureTcpTime=ce(k?D-k:0,"https安全链接(ssl)握手花费时间"),e.resposeTime=ce(I-F,"请求成功后下载响应数据花费时间"),e.analysisDomTime=ce(W-N,"单页面客户端渲染下，为解析模板dom树所花费时间；非单页面或单页面服务端渲染下，为解析实际dom树所花费时间"),e.domReadyTime=ce(J-B,"单页面客户端渲染下，为生成模板dom树所花费时间；非单页面或单页面服务端渲染下，为生成实际dom树所花费时间"),e.domContentLoadEventTime=ce(J-q,"onDomContentLoad事件执行花费的时间"),e.serverTiming=ce(U,"一个请求内，服务器在响应过程中，各步骤耗时指标。由后端设置于reponse header中，受跨域限制"),e.LoadEventTime=ce(ee-Z,"onLoad事件执行花费的时间"),e.pageLoadTime=ce(ee-B,"单页面客户端渲染下，模板页面加载(用户等待)所花费时间；非单页面或单页面服务端渲染下，为实际页面加载(用户等待)花费时间"),e.startRender=ce(q-h,"TTFB(发起请求到服务器返回数据的时间) + TTDD(从服务器加载HTML文档的时间) + TTHE(HTML文档头部解析完成所需要的时间)"),e}function v(e,o,n,t){var d=0<arguments.length&&void 0!==e?e:function(){},i=1<arguments.length&&void 0!==o?o:100,a=2<arguments.length&&void 0!==n?n:1e3,v=3<arguments.length&&void 0!==t?t:"",c=window.performance.now(),m=setInterval(function(){var e=window.performance.now();if(0<window.performance.getEntriesByType("paint").length){clearInterval(m);var o=s(),n=function(){var e={},o=window.performance.getEntriesByType("navigation")[0].fetchStart,n=void 0===o?0:o,t=window.performance.getEntriesByType("paint")[0].startTime,i=void 0===t?0:t;e.firstPaintTime=ce(i-n,"首次渲染时间(第⼀个非网页背景像素渲染)");var r=window.performance.getEntriesByType("paint")[1].startTime,d=void 0===r?0:r;return e.firstContentPaintTime=ce(d-n,"首次内容渲染时间(第一个 ⽂本、图像、背景图片或非白色 canvas/SVG 内容渲染)"),e}(),t=Object.assign({},o,n,{msg:"包含paint相关信息!",type:v});d(t)}else if(a<e-c){clearInterval(m);var i=s(),r=Object.assign({},i,{msg:"未包含paint相关信息(总轮询时间太短或不支持paint类型entry)!",type:v});d(r)}},i)}var me={0:"TYPE_NAVIGATE  ，点击链接、地址栏输入、表单提交、脚本操作等。",1:"TYPE_RELOAD  ，点击重新加载按钮、location.reload。",2:"TYPE_BACK_FORWARD，点击前进或后退按钮。",255:"TYPE_RESERVED，任何其他来源。即非刷新/非前进后退、非点击链接/地址栏输入/表单提交/脚本操作等。"};return{switchPerformance:function(e,o){var n=0<arguments.length&&void 0!==e?e:100,t=1<arguments.length&&void 0!==o?o:1e3;return i(),new Promise(function(){v(0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},n,t,"SWITCH")})},closePerformance:function(e,o){var n=0<arguments.length&&void 0!==e?e:0,t=1<arguments.length&&void 0!==o?o:0;return i(),new Promise(function(){v(0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},n,t,"CLOSE")})},onloadPerformance:function(e,o){var r=0<arguments.length&&void 0!==e?e:100,d=1<arguments.length&&void 0!==o?o:5e3;return i(),new Promise(function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){},t=window.onload,i=a(t);window.onload=function(e){var o=0<arguments.length&&void 0!==e?e:{};v(n,r,d,"ONLOAD"),i&&t(o)}})}}}();